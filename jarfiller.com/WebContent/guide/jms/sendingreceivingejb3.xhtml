<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns="http://www.w3.org/1999/xhtml" xmlns:fn="http://www.w3.org/2005/xpath-functions" xmlns:page="http://tjansen.de/refPage" xmlns:i="http://tjansen.de/internal"><head><title>Sending and Receiving Messages in EJB 3 Applications - JMS Guide</title><meta http-equiv="X-UA-Compatible" content="chrome=1"/><meta http-equiv="content-language" content="en"/><link rel="shortcut icon" href="../../images/favicon.png" type="image/png"/><link rel="stylesheet" type="text/css" href="../../style/style.css"/><script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-6791190-2']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
})();
</script><script type="text/javascript" src="../../js/all.js"/></head><body id="body"><div id="visibleContent"><div id="top"><a href="/"><img src="../../images/titlebar.png" alt="Jarfiller.com"/></a></div><div id="main"><div id="bodycolumn"><div class="yahbar"><div class="yahprev"><a href="standaloneclient.xhtml">Prev</a></div><h3 class="yahhere"><a href="#" onclick="return navToggle();">JMS Guide / Sending and Receiving Messages in EJB 3 Applications</a></h3><div class="yahnext"><a href="topics.xhtml">Next</a></div></div><h1 id="sec_sendingreceivingejb3" class="multipageTitle"><a name="sendingreceivingejb3">Sending and Receiving Messages in EJB 3 Applications</a></h1><div class="subSecRow1" id="sec_sendingejb3"><div class="subSecHead" id="sechd_sendingejb3"><a name="sendingejb3">Sending Messages</a><br/>(<a href="#" id="tl-d18684e1354" class="dottedTooltip" onclick="return tlClick('tl-d18684e1354','pp-d18684e1359');" onmouseover="return tlOver('tl-d18684e1354','pp-d18684e1359');" onmouseout="return tlOut('tl-d18684e1354','pp-d18684e1359');">more</a>)
		</div><div class="subSecContent" id="seccnt_sendingejb3"><pre class="subSecCode"><code><span class="cmt">// MySenderLocal.java: the interface of the sending bean</span>
@Local
public interface MySenderLocal {
  void sendMessage(String txt) throws <a href="http://java.sun.com/javaee/5/docs/api/javax/jms/JMSException.html" class="javadoc">JMSException</a>;
}

</code></pre><pre class="subSecCode"><code><span class="cmt">// MySenderLocal.java: implementation of MySenderLocal</span>
@Stateless
public class MySender implements MySenderLocal {

  <em><a href="http://java.sun.com/javaee/5/docs/api/javax/annotation/Resource.html" class="javadoc">@Resource</a>(<a href="http://java.sun.com/javaee/5/docs/api/javax/annotation/Resource.html#mappedName()" class="javadoc">mappedName</a>="/ConnectionFactory")</em>     <span class="cmt">// inject <span class="idf">ConnectionFactory</span> (<a href="#" id="tl-d18684e1433" class="dottedTooltip" onclick="return tlClick('tl-d18684e1433','pp-d18684e1433');" onmouseover="return tlOver('tl-d18684e1433','pp-d18684e1433');" onmouseout="return tlOut('tl-d18684e1433','pp-d18684e1433');">more</a>)</span>
  private <a href="http://java.sun.com/javaee/5/docs/api/javax/jms/ConnectionFactory.html" class="javadoc">ConnectionFactory</a> factory;

  <em><a href="http://java.sun.com/javaee/5/docs/api/javax/annotation/Resource.html" class="javadoc">@Resource</a>(<a href="http://java.sun.com/javaee/5/docs/api/javax/annotation/Resource.html#mappedName()" class="javadoc">mappedName</a>="/queue/JarfillerQueue")</em>  <span class="cmt">// inject <span class="idf">Queue</span> (<a href="#" id="tl-d18684e1470" class="dottedTooltip" onclick="return tlClick('tl-d18684e1470','pp-d18684e1470');" onmouseover="return tlOver('tl-d18684e1470','pp-d18684e1470');" onmouseout="return tlOut('tl-d18684e1470','pp-d18684e1470');">more</a>)</span>
  private <a href="http://java.sun.com/javaee/5/docs/api/javax/jms/Queue.html" class="javadoc">Queue</a> target;

  <span class="cmt">// Sends the given string as text message:</span>
  public void <em>sendMessage(String txt)</em> throws <a href="http://java.sun.com/javaee/5/docs/api/javax/jms/JMSException.html" class="javadoc">JMSException</a> {
    <a href="http://java.sun.com/javaee/5/docs/api/javax/jms/Connection.html" class="javadoc">Connection</a> con = factory.<a href="http://java.sun.com/javaee/5/docs/api/javax/jms/ConnectionFactory.html#createConnection()" class="javadoc">createConnection</a>();
    try {
      <a href="http://java.sun.com/javaee/5/docs/api/javax/jms/Session.html" class="javadoc">Session</a> session = con.<a href="http://java.sun.com/javaee/5/docs/api/javax/jms/Connection.html#createSession(boolean, int)" class="javadoc">createSession</a>(false, <a href="http://java.sun.com/javaee/5/docs/api/javax/jms/Session.html#AUTO_ACKNOWLEDGE" class="javadoc">Session.AUTO_ACKNOWLEDGE</a>);
      <a href="http://java.sun.com/javaee/5/docs/api/javax/jms/MessageProducer.html" class="javadoc">MessageProducer</a> producer = session.<a href="http://java.sun.com/javaee/5/docs/api/javax/jms/Session.html#createProducer(javax.jms.Destination)" class="javadoc">createProducer</a>(target);
      producer.<a href="http://java.sun.com/javaee/5/docs/api/javax/jms/MessageProducer.html#send(javax.jms.Message)" class="javadoc">send</a>(session.<a href="http://java.sun.com/javaee/5/docs/api/javax/jms/Session.html#createTextMessage(java.lang.String)" class="javadoc">createTextMessage</a>(txt));
    }
    finally {
      con.<a href="http://java.sun.com/javaee/5/docs/api/javax/jms/Connection.html#close()" class="javadoc">close</a>();
    }
  }
}
</code></pre></div></div><div class="subSecRow2" id="sec_receivingejb3"><div class="subSecHead" id="sechd_receivingejb3"><a name="receivingejb3">Receiving messages</a><br/>(<a href="#" id="tl-d18684e1573" class="dottedTooltip" onclick="return tlClick('tl-d18684e1573','pp-d18684e1578');" onmouseover="return tlOver('tl-d18684e1573','pp-d18684e1578');" onmouseout="return tlOut('tl-d18684e1573','pp-d18684e1578');">more</a>)
		</div><div class="subSecContent" id="seccnt_receivingejb3"><pre class="subSecCode"><code><a href="http://java.sun.com/javaee/5/docs/api/javax/ejb/MessageDriven.html" class="javadoc"><em>@MessageDriven</em></a>(                                     <span class="cmt">// <em>Message-driven bean</em> (MDB)</span>
  <a href="http://java.sun.com/javaee/5/docs/api/javax/ejb/MessageDriven.html#activationConfig()" class="javadoc">activationConfig</a> = { <a href="http://java.sun.com/javaee/5/docs/api/javax/ejb/ActivationConfigProperty.html" class="javadoc">@ActivationConfigProperty</a>(   <span class="cmt">// activation configuration (<a href="#" id="tl-d18684e1609" class="dottedTooltip" onclick="return tlClick('tl-d18684e1609','pp-d18684e1609');" onmouseover="return tlOver('tl-d18684e1609','pp-d18684e1609');" onmouseout="return tlOut('tl-d18684e1609','pp-d18684e1609');">more</a>)</span>
    <a href="http://java.sun.com/javaee/5/docs/api/javax/ejb/ActivationConfigProperty.html#propertyName()" class="javadoc">propertyName</a> = "destinationType", 
    <a href="http://java.sun.com/javaee/5/docs/api/javax/ejb/ActivationConfigProperty.html#propertyValue()" class="javadoc">propertyValue</a> = "javax.jms.Queue"
    ),
    <a href="http://java.sun.com/javaee/5/docs/api/javax/ejb/ActivationConfigProperty.html" class="javadoc">@ActivationConfigProperty</a>(
    <a href="http://java.sun.com/javaee/5/docs/api/javax/ejb/ActivationConfigProperty.html#propertyName()" class="javadoc">propertyName</a> = "destination", 
    <a href="http://java.sun.com/javaee/5/docs/api/javax/ejb/ActivationConfigProperty.html#propertyValue()" class="javadoc">propertyValue</a> = "<em>/queue/JarfillerQueue</em>"         <span class="cmt">// destination's JNDI name</span>
  ) })
public class MyMDB implements <a href="http://java.sun.com/javaee/5/docs/api/javax/jms/MessageListener.html" class="javadoc"><em>MessageListener</em></a> {

  public void <a href="http://java.sun.com/javaee/5/docs/api/javax/jms/onMessage.html" class="javadoc">onMessage</a>(<a href="http://java.sun.com/javaee/5/docs/api/javax/jms/Message.html" class="javadoc">Message</a> message) {          <span class="cmt">// process message here</span>
    <a href="http://java.sun.com/javaee/5/docs/api/javax/jms/TextMessage.html" class="javadoc">TextMessage</a> textMsg = (<a href="http://java.sun.com/javaee/5/docs/api/javax/jms/TextMessage.html" class="javadoc">TextMessage</a>) message;
    try {
      System.out.println("Got message: " + textMsg.getText());
    }
    catch (<a href="http://java.sun.com/javaee/5/docs/api/javax/jms/JMSException.html" class="javadoc">JMSException</a> e) {
      System.out.println("Error retrieving message content");
    }
  }
}
</code></pre></div></div><div class="subSecRow1" id="sec_jbosssetup"><div class="subSecHead" id="sechd_jbosssetup"><a name="jbosssetup">JBoss 5.x Setup</a></div><div class="subSecContent" id="seccnt_jbosssetup"><h2 class="subSecSummaryNoClick">How to set up JBoss 5.x</h2><p class="subSecExplanation">Before you can deploy the message-driven bean and the sender bean from the previous examples in a <a href="http://www.jboss.org/jbossas/">JBoss Application Server</a>, you need to <em>configure JBoss Messaging</em>. In the default profile, the <a href="http://java.sun.com/javaee/5/docs/api/javax/jms/ConnectionFactory.html" class="javadoc">ConnectionFactory</a> is already set up and available under the JNDI name "/ConnectionFactory". You can find this setting in the file "server/<span class="abstract">&lt;profile-name&gt;</span>/deploy/messaging/connection-factories-service.xml".<br/> You only need to declare your queue (or, generally speaking, your destinations). The usual place to do this is the file "server/<span class="abstract">&lt;profile-name&gt;</span>/deploy/messaging/jbossmq-destination-service.xml". If the file does not exist, just create it. If it does exist, just <em>add the following <span class="idf">&lt;mbean&gt;</span> element to <span class="idf">jbossmq-destination-service.xml</span></em>.<br/> In order to create a single queue with the JNDI name "/queue/JarfillerQueue", the file should look like this:</p><pre class="subSecCode"><code>&lt;server&gt;
  &lt;mbean code="org.jboss.mq.server.jmx.Queue"
         name="jboss.mq.destination:service=Queue,<em>name=JarfillerQueue</em>"&gt;
    &lt;depends optional-attribute-name="DestinationManager"&gt;
       jboss.mq:service=DestinationManager
    &lt;/depends&gt;
  &lt;/mbean&gt;
&lt;/server&gt;
</code></pre><p class="subSecExplanation"> The prefix "/queue/" of the JNDI name comes from the file "messaging-service.xml". </p></div></div><div class="yahbar"><div class="yahprev"><a href="standaloneclient.xhtml">Prev<br/><span>Sending and Receiving Messages (Standalone Client)</span></a></div><div class="yahhere"><a href="#" onclick="return navToggle();">JMS Guide / Sending and Receiving Messages in EJB 3 Applications</a><br/><a href="/guide/jms/"><span>Single Page Mode</span></a>, <a href="#" onclick="return navToggle();"><span>Show Table of Content</span></a></div><div class="yahnext"><a href="topics.xhtml">Next<br/><span>Using Topics</span></a></div></div></div><div id="sidecolumn">
    	<div><h3>Useful Links</h3><div class="sidecolumnSubTitleLine"/>
  			<a href="http://java.sun.com/products/jms/">JMS Homepage</a><br/>
  			<a href="http://en.wikipedia.org/wiki/Java_Message_Service">JMS on Wikipedia</a><br/>
  			<a href="http://java.sun.com/javaee/5/docs/api/javax/jms/package-summary.html">javax.jms API Docs</a><br/>
  			<a href="http://java.sun.com/products/jms/docs.html">JMS Specification</a><br/>
  		</div>
  </div></div></div><div id="footer"><div id="footer-content"><div id="footer-left"><div class="footerLine"><a href="/">Home</a> - <a href="/about">About Jarfiller</a> - <a href="/imprint.xhtml">Imprint</a></div><div class="footerLine">Please send feedback and corrections to <a href="mailto:tim@tjansen.de">tim@<span style="display: none">got you</span>tjansen.de</a>.</div><div class="footerLine"><a href="http://www.twitter.com/timjansen">Follow</a> me on Twitter.</div><div class="copyrightLine">© 2010 Tim Jansen; content licensed under <a href="http://creativecommons.org/licenses/by/3.0/us/">cc-by</a>; example source code is public domain
				</div></div><div id="footer-right"><a rel="license" href="http://creativecommons.org/licenses/by/3.0/us/"><img alt="Creative Commons License" style="border-width:0" src="../../images/ext/cc-by-88x31.png"/></a></div></div></div><div id="navbar" onclick="return navToggle();" onmouseover="document.getElementById('navbar').className='mouseover';" onmouseout="document.getElementById('navbar').className='';"/><div id="navcontainer"><div id="navlinks"><div id="navclosebar"><a href="#" onclick="return navClose();"><img src="../../images/close.png" height="16" width="16" alt="close"/></a></div><div id="navpositionbar" class="navpositionbar"/><h2 id="navtitle">JMS Guide</h2><a id="nav_jmsoverview" class="navseclink" href="jmsoverview.xhtml#jmsoverview">Overview</a><a id="nav_intro" class="navsublink" href="jmsoverview.xhtml#intro">Intro</a><a id="nav_usecases" class="navsublink" href="jmsoverview.xhtml#usecases">When should JMS be used?</a><a id="nav_requirements" class="navsublink" href="jmsoverview.xhtml#requirements">What do you need for JMS?</a><a id="nav_destinations" class="navsublink" href="jmsoverview.xhtml#destinations">Destinations</a><a id="nav_standaloneclient" class="navseclink" href="standaloneclient.xhtml#standaloneclient">Sending and Receiving Messages (Standalone Client)</a><a id="nav_sending" class="navsublink" href="standaloneclient.xhtml#sending">Sending a message</a><a id="nav_polling" class="navsublink" href="standaloneclient.xhtml#polling">Polling for messages</a><a id="nav_messagelistener" class="navsublink" href="standaloneclient.xhtml#messagelistener">Using a MessageListener</a><a id="nav_jndi" class="navsublink" href="standaloneclient.xhtml#jndi">Getting the ConnectionFactory via JNDI</a><a id="nav_activemqsetup" class="navsublink" href="standaloneclient.xhtml#activemqsetup">How to set up ActiveMQ</a><a id="nav_webspheremqsetup" class="navsublink" href="standaloneclient.xhtml#webspheremqsetup">How to set up Websphere MQ</a><a id="nav_sendingreceivingejb3" class="navseclink" href="#sendingreceivingejb3" onclick="if (event.button == 0) return goTo('#sendingreceivingejb3', true); else return true;">Sending and Receiving Messages in EJB 3 Applications</a><a id="nav_sendingejb3" class="navsublink" href="#sendingejb3" onclick="if (event.button == 0) return goTo('#sendingejb3', true); else return true;">Sending Messages</a><a id="nav_receivingejb3" class="navsublink" href="#receivingejb3" onclick="if (event.button == 0) return goTo('#receivingejb3', true); else return true;">Receiving messages</a><a id="nav_jbosssetup" class="navsublink" href="#jbosssetup" onclick="if (event.button == 0) return goTo('#jbosssetup', true); else return true;">How to set up JBoss 5.x</a><a id="nav_topics" class="navseclink" href="topics.xhtml#topics">Using Topics</a><a id="nav_sendingtopics" class="navsublink" href="topics.xhtml#sendingtopics">Sending Topic Messages</a><a id="nav_receivingtopics" class="navsublink" href="topics.xhtml#receivingtopics">Receiving Topic Messages</a><a id="nav_durablesubscription" class="navsublink" href="topics.xhtml#durablesubscription">Durable Subscription</a><a id="nav_endingsubscription" class="navsublink" href="topics.xhtml#endingsubscription">Cancelling a subscription</a><a id="nav_messagetypes" class="navseclink" href="messagetypes.xhtml#messagetypes">Message Types</a><a id="nav_textmessages" class="navsublink" href="messagetypes.xhtml#textmessages">TextMessage</a><a id="nav_mapmessages" class="navsublink" href="messagetypes.xhtml#mapmessages">MapMessage</a><a id="nav_streammessages" class="navsublink" href="messagetypes.xhtml#streammessages">StreamMessage</a><a id="nav_objectmessages" class="navsublink" href="messagetypes.xhtml#objectmessages">ObjectMessage</a><a id="nav_bytesmessages" class="navsublink" href="messagetypes.xhtml#bytesmessages">BytesMessage</a><a id="nav_emptymessages" class="navsublink" href="messagetypes.xhtml#emptymessages">Empty Messages</a><span class="navseclink">How to...</span><a id="nav_messageheaders" class="navsublink" href="messageheaders.xhtml#messageheaders">How to use Message Headers</a><a id="nav_messageproperties" class="navsublink" href="messageproperties.xhtml#messageproperties">How to read and set Message Properties</a><a id="nav_selectors" class="navsublink" href="selectors.xhtml#selectors">How to use Message Selectors to filter messages</a><a id="nav_xml" class="navsublink" href="xml.xhtml#xml">How to send and receive XML messages with DOM or JAXB</a><a id="nav_achknowledgement" class="navsublink" href="achknowledgement.xhtml#achknowledgement">How to control acknowledgement</a><a id="nav_browsing" class="navsublink" href="browsing.xhtml#browsing">How to browse the messages in a queue</a><a id="nav_authentication" class="navsublink" href="authentication.xhtml#authentication">How to authenticate a connection</a><a id="nav_temporaryqueues" class="navsublink" href="temporaryqueues.xhtml#temporaryqueues">How to Create Temporary Queues or Topics</a><a id="nav_requestresponse" class="navsublink" href="requestresponse.xhtml#requestresponse">How to send a response to a message (Request/Reply)</a><a id="nav_deliveryoptions" class="navsublink" href="deliveryoptions.xhtml#deliveryoptions">How to Control Message Delivery (Delivery Mode, Time-to-live and Priority)</a><a id="nav_activationproperties" class="navsublink" href="activationproperties.xhtml#activationproperties">How to Configure a Message-Driven Bean (Activation Properties, Durable Subscriptions)</a><a id="nav_concurrency" class="navsublink" href="concurrency.xhtml#concurrency">How to use JMS in multi-threaded applications</a><a id="nav_classes10" class="navsublink" href="classes10.xhtml#classes10">How to Use QueueConnectionFactory, QueueConnection, QueueSession...</a><a id="nav_andnow" class="navseclink" href="andnow.xhtml#andnow">And now...?</a><a id="nav_nextsteps" class="navsublink" href="andnow.xhtml#nextsteps">Next Steps</a></div></div><div id="popups"><div id="pp-d18684e1359" class="tooltip">The easiest way to send a message in a EJB 3 session bean is to <em>let the container inject references</em> for <span class="idf">ConnectionFactory</span> and <span class="idf">Destination</span> into your session bean. You can use them exactly like in stand-alone clients.<br/> Unfortunately the injection is a bit container-specific: most containers allow you to specify the global JNDI name of the <span class="idf">@Resource</span> in the <span class="idf">mappedName</span> property. Those that don't (like Websphere AS) require you to write a container-specific deployment descriptor and do the mapping there.</div><div id="pp-d18684e1433" class="tooltip">This annotation let's the container inject the reference to the <span class="idf">ConnectionFactory</span> into the bean. "/ConnectionFactory" is the JNDI name configured in the server (in JBoss it is the default name for its own JMS implementation).<br/> <strong class="warn">Note:</strong> the <span class="idf">mappedName</span> property is not very portable. Some application servers (most notably Websphere AS) do not support it.</div><div id="pp-d18684e1470" class="tooltip">This annotation let's the container inject the reference to the <span class="idf">Queue</span> into the bean. "/queue/JarfillerQueue" is the JNDI name configured in the server.<br/> <strong class="warn">Note:</strong> the <span class="idf">mappedName</span> property is not very portable. Some application servers (most notably Websphere AS) do not support it.</div><div id="pp-d18684e1578" class="tooltip">In order to receive messages in an EJB container, create a <span class="idf">Message Driven Bean</span> (MDB). It implements the <span class="idf">MessageListener</span> interface which will be invoked every time a message is received.</div><div id="pp-d18684e1609" class="tooltip">The activation configuration defines when the message-driven bean will be called. It contains properties as name/value pairs. The most important properties are "destinationType" which specifies whether the destination is a queue or a topic ("javax.jms.Topic"), and the "destination" with the destination's JNDI name.</div><div id="ttCloseBar" class="closeBar"><a href="#" onclick="return tlClose();"><img src="../../images/close.png" height="16" width="16" alt="close"/></a></div><div id="topicCloseBar" class="closeBar"><a href="#" onclick="return tpcClose();"><img src="../../images/close.png" height="16" width="16" alt="close"/></a></div></div></body></html>