<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns="http://www.w3.org/1999/xhtml" xmlns:fn="http://www.w3.org/2005/xpath-functions" xmlns:page="http://tjansen.de/refPage" xmlns:i="http://tjansen.de/internal"><head><title>Working with Statements - JDBC Guide</title><meta http-equiv="X-UA-Compatible" content="chrome=1"/><meta http-equiv="content-language" content="en"/><link rel="shortcut icon" href="../../images/favicon.png" type="image/png"/><link rel="stylesheet" type="text/css" href="../../style/style.css"/><script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-6791190-2']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
})();
</script><script type="text/javascript" src="../../js/all.js"/></head><body id="body"><div id="visibleContent"><div id="top"><a href="/"><img src="../../images/titlebar.png" alt="Jarfiller.com"/></a></div><div id="main"><div id="bodycolumn"><div class="yahbar"><div class="yahprev"><a href="parameters.xhtml">Prev</a></div><h3 class="yahhere"><a href="#" onclick="return navToggle();">JDBC Guide / Working with Statements</a></h3><div class="yahnext"><a href="plainstatements.xhtml">Next</a></div></div><h1 id="sec_workstatements" class="multipageTitle"><a name="workstatements">Working with Statements</a></h1><div class="subSecRow2" id="sec_transactions"><div class="subSecHead" id="sechd_transactions"><a name="transactions">Transactions</a><br/>(<a href="#" id="tl-d5630e1954" class="dottedTooltip" onclick="return tlClick('tl-d5630e1954','pp-d5630e1959');" onmouseover="return tlOver('tl-d5630e1954','pp-d5630e1959');" onmouseout="return tlOut('tl-d5630e1954','pp-d5630e1959');">more</a>)
		</div><div class="subSecContent" id="seccnt_transactions"><p class="subSecExplanation">Connections are in <em><a href="#" id="tl-d5630e1979" class="dottedTooltip" onclick="return tlClick('tl-d5630e1979','pp-d5630e1983');" onmouseover="return tlOver('tl-d5630e1979','pp-d5630e1983');" onmouseout="return tlOut('tl-d5630e1979','pp-d5630e1983');">auto-commit</a> mode by default</em>. You can automatically <em>begin a <a href="#" id="tl-d5630e1995" class="dottedTooltip" onclick="return tlClick('tl-d5630e1995','pp-d5630e1998');" onmouseover="return tlOver('tl-d5630e1995','pp-d5630e1998');" onmouseout="return tlOut('tl-d5630e1995','pp-d5630e1998');">transaction</a> by turning it off</em> (there is no explicit <span class="idf">begin</span> method). The transaction runs until you call <a href="http://java.sun.com/javase/6/docs/api/java/sql/Connection.html#commit()" class="javadoc">commit</a> or <a href="http://java.sun.com/javase/6/docs/api/java/sql/Connection.html#rollback()" class="javadoc">rollback</a>, which will end the current transaction and start a new one.</p><pre class="subSecCode"><code><a href="http://java.sun.com/javase/6/docs/api/java/sql/Connection.html" class="javadoc">Connection</a> connection = <span class="abstract">...</span> ;
try {
    connection.<em><a href="http://java.sun.com/javase/6/docs/api/java/sql/Connection.html#setAutoCommit(boolean)" class="javadoc">setAutoCommit</a>(false)</em>;  <span class="cmt">// <em>begin transaction</em></span>

    String sql = "UPDATE Movie SET title=? WHERE title=?";
    <a href="http://java.sun.com/javase/6/docs/api/java/sql/PreparedStatement.html" class="javadoc">PreparedStatement</a> stmt = connection.<a href="http://java.sun.com/javase/6/docs/api/java/sql/Connection.html#prepareStatement(java.lang.String)" class="javadoc">prepareStatement</a>(sql);

    stmt.<a href="http://java.sun.com/javase/6/docs/api/java/sql/PreparedStatement.html#setString(int, java.lang.String)" class="javadoc">setString</a>(1, "Jaws 3-D");
    stmt.<a href="http://java.sun.com/javase/6/docs/api/java/sql/PreparedStatement.html#setString(int, java.lang.String)" class="javadoc">setString</a>(2, "Jaws 3");
    stmt.<a href="http://java.sun.com/javase/6/docs/api/java/sql/PreparedStatement.html#executeUpdate()" class="javadoc">executeUpdate</a>();

    stmt.<a href="http://java.sun.com/javase/6/docs/api/java/sql/PreparedStatement.html#setString(int, java.lang.String)" class="javadoc">setString</a>(1, "Amityville 3-D");
    stmt.<a href="http://java.sun.com/javase/6/docs/api/java/sql/PreparedStatement.html#setString(int, java.lang.String)" class="javadoc">setString</a>(2, "Amityville 3");
    stmt.<a href="http://java.sun.com/javase/6/docs/api/java/sql/PreparedStatement.html#executeUpdate()" class="javadoc">executeUpdate</a>();

    connection.<a href="http://java.sun.com/javase/6/docs/api/java/sql/Connection.html#commit()" class="javadoc"><em>commit</em></a>();
}
catch (RuntimeException e) {
    connection.<a href="http://java.sun.com/javase/6/docs/api/java/sql/Connection.html#rollback()" class="javadoc"><em>rollback</em></a>();            <span class="cmt">// rollback on unhandled error</span>
}
finally {
    connection.<a href="http://java.sun.com/javase/6/docs/api/java/sql/Connection.html#close()" class="javadoc">close</a>();
}
</code></pre><p class="subSecExplanation">Note that code running in an application server should <em>let the server manage transactions</em> (<a href="appservertransactions.xhtml#appservertransactions">see below</a>).</p></div></div><div class="subSecRow1" id="sec_closing"><div class="subSecHead" id="sechd_closing"><a name="closing">Closing Resources</a><br/>(<a href="#" id="tl-d5630e2163" class="dottedTooltip" onclick="return tlClick('tl-d5630e2163','pp-d5630e2168');" onmouseover="return tlOver('tl-d5630e2163','pp-d5630e2168');" onmouseout="return tlOut('tl-d5630e2163','pp-d5630e2168');">more</a>)
		</div><div class="subSecContent" id="seccnt_closing"><p class="subSecExplanation"> When you close a <a href="http://java.sun.com/javase/6/docs/api/java/sql/Collection.html" class="javadoc">Collection</a>, all dependent resources will be freed as well. Often this is sufficient, but in a <em>long running connection</em>, save resources by <em>closing <span class="idf">Statement</span>s and <span class="idf">ResultSet</span>s explicitly</em>. </p><pre class="subSecCode"><code><a href="http://java.sun.com/javase/6/docs/api/java/sql/Connection.html" class="javadoc">Connection</a> connection = <span class="abstract">...</span> ;
try {
    String sql = "SELECT * FROM Movie";
    <a href="http://java.sun.com/javase/6/docs/api/java/sql/PreparedStatement.html" class="javadoc">PreparedStatement</a> stmt = connection.<a href="http://java.sun.com/javase/6/docs/api/java/sql/Connection.html#prepareStatement(java.lang.String)" class="javadoc">prepareStatement</a>(sql);

    <a href="http://java.sun.com/javase/6/docs/api/java/sql/ResultSet.html" class="javadoc">ResultSet</a> rs = stmt.<a href="http://java.sun.com/javase/6/docs/api/java/sql/PreparedStatement.html#executeQuery()" class="javadoc">executeQuery</a>();
    while (rs.<a href="http://java.sun.com/javase/6/docs/api/java/sql/ResultSet.html#next()" class="javadoc">next</a>()) {
        <span class="cmt">// ...</span>
    }
    rs.<a href="http://java.sun.com/javase/6/docs/api/java/sql/ResultSet.html#close()" class="javadoc"><em>close</em></a>();          <span class="cmt">// <span class="idf">rs</span> not needed anymore</span>

    <a href="http://java.sun.com/javase/6/docs/api/java/sql/ResultSet.html" class="javadoc">ResultSet</a> rs2 = stmt.<a href="http://java.sun.com/javase/6/docs/api/java/sql/PreparedStatement.html#executeQuery()" class="javadoc">executeQuery</a>();
    while (rs2.<a href="http://java.sun.com/javase/6/docs/api/java/sql/ResultSet.html#next()" class="javadoc">next</a>()) {
        <span class="cmt">// ...</span>
    }
    stmt.<a href="http://java.sun.com/javase/6/docs/api/java/sql/Statement.html#close()" class="javadoc"><em>close</em></a>();        <span class="cmt">// also closes <span class="idf">rs2</span> (<a href="#" id="tl-d5630e2306" class="dottedTooltip" onclick="return tlClick('tl-d5630e2306','pp-d5630e2306');" onmouseover="return tlOver('tl-d5630e2306','pp-d5630e2306');" onmouseout="return tlOut('tl-d5630e2306','pp-d5630e2306');">more</a>)</span>

    connection.<a href="http://java.sun.com/javase/6/docs/api/java/sql/Connection.html#prepareStatement(java.lang.String)" class="javadoc">prepareStatement</a>("DELETE FROM Movie WHERE budget &lt; 1000000").<a href="http://java.sun.com/javase/6/docs/api/java/sql/PreparedStatement.html#executeUpdate()" class="javadoc">executeUpdate</a>();
}
finally {
    connection.<a href="http://java.sun.com/javase/6/docs/api/java/sql/Connection.html#close()" class="javadoc">close</a>();  <span class="cmt">// also closes its <span class="idf">Statement</span>s</span>
}
</code></pre></div></div><div class="yahbar"><div class="yahprev"><a href="parameters.xhtml">Prev<br/><span>Parameters</span></a></div><div class="yahhere"><a href="#" onclick="return navToggle();">JDBC Guide / Working with Statements</a><br/><a href="/guide/jdbc/"><span>Single Page Mode</span></a>, <a href="#" onclick="return navToggle();"><span>Show Table of Content</span></a></div><div class="yahnext"><a href="plainstatements.xhtml">Next<br/><span>Plain Statements</span></a></div></div></div><div id="sidecolumn">
    	<div><h3>Useful Links</h3><div class="sidecolumnSubTitleLine"/>
  			<a href="http://java.sun.com/javase/technologies/database/">JDBC Homepage</a><br/>
  			<a href="http://en.wikipedia.org/wiki/Java_Database_Connectivity">JDBC on Wikipedia</a><br/>
  			<a href="http://java.sun.com/javase/6/docs/api/java/sql/package-summary.html">java.sql API Docs</a><br/>
  			<a href="http://java.sun.com/javase/6/docs/api/javax/sql/package-summary.html">javax.sql API Docs</a><br/>
  			<a href="http://jcp.org/aboutJava/communityprocess/final/jsr221/index.html">JDBC 4.0 Specification</a><br/>
  		</div>
  </div></div></div><div id="footer"><div id="footer-content"><div id="footer-left"><div class="footerLine"><a href="/">Home</a> - <a href="/about">About Jarfiller</a> - <a href="/imprint.xhtml">Imprint</a></div><div class="footerLine">Please send feedback and corrections to <a href="mailto:tim@tjansen.de">tim@<span style="display: none">got you</span>tjansen.de</a>.</div><div class="footerLine"><a href="http://www.twitter.com/timjansen">Follow</a> me on Twitter.</div><div class="copyrightLine">© 2010 Tim Jansen; content licensed under <a href="http://creativecommons.org/licenses/by/3.0/us/">cc-by</a>; example source code is public domain
				</div></div><div id="footer-right"><a rel="license" href="http://creativecommons.org/licenses/by/3.0/us/"><img alt="Creative Commons License" style="border-width:0" src="../../images/ext/cc-by-88x31.png"/></a></div></div></div><div id="navbar" onclick="return navToggle();" onmouseover="document.getElementById('navbar').className='mouseover';" onmouseout="document.getElementById('navbar').className='';"/><div id="navcontainer"><div id="navlinks"><div id="navclosebar"><a href="#" onclick="return navClose();"><img src="../../images/close.png" height="16" width="16" alt="close"/></a></div><div id="navpositionbar" class="navpositionbar"/><h2 id="navtitle">JDBC Guide</h2><a id="nav_overview" class="navseclink" href="overview.xhtml#overview">Overview</a><a id="nav_intro" class="navsublink" href="overview.xhtml#intro">Intro</a><a id="nav_usecases" class="navsublink" href="overview.xhtml#usecases">When should you use JDBC for?</a><a id="nav_requirements" class="navsublink" href="overview.xhtml#requirements">What do you need for JDBC?</a><a id="nav_connecting" class="navseclink" href="connecting.xhtml#connecting">Connecting</a><a id="nav_standalone" class="navsublink" href="connecting.xhtml#standalone">Stand-Alone</a><a id="nav_jeecontainer" class="navsublink" href="connecting.xhtml#jeecontainer">JEE Container</a><a id="nav_javadb" class="navsublink" href="connecting.xhtml#javadb">Connecting to Java DB</a><a id="nav_postgresql" class="navsublink" href="connecting.xhtml#postgresql">Connecting to PostgreSQL</a><a id="nav_oracle" class="navsublink" href="connecting.xhtml#oracle">Connecting to Oracle Database</a><a id="nav_exampleschema" class="navsublink" href="connecting.xhtml#exampleschema">Database Schema for the Following Examples</a><a id="nav_updatesandqueries" class="navseclink" href="updatesandqueries.xhtml#updatesandqueries">Updates and Queries</a><a id="nav_update" class="navsublink" href="updatesandqueries.xhtml#update">Update</a><a id="nav_query" class="navsublink" href="updatesandqueries.xhtml#query">Query</a><a id="nav_valueconversion" class="navsublink" href="updatesandqueries.xhtml#valueconversion">Value Conversion</a><a id="nav_colindex" class="navsublink" href="updatesandqueries.xhtml#colindex">Column Index</a><a id="nav_parameters" class="navseclink" href="parameters.xhtml#parameters">Parameters</a><a id="nav_parameters1" class="navsublink" href="parameters.xhtml#parameters1">Parameters</a><a id="nav_reusing" class="navsublink" href="parameters.xhtml#reusing">Reusing Statements</a><a id="nav_workstatements" class="navseclink" href="#workstatements" onclick="if (event.button == 0) return goTo('#workstatements', true); else return true;">Working with Statements</a><a id="nav_transactions" class="navsublink" href="#transactions" onclick="if (event.button == 0) return goTo('#transactions', true); else return true;">Transactions</a><a id="nav_closing" class="navsublink" href="#closing" onclick="if (event.button == 0) return goTo('#closing', true); else return true;">Closing Resources</a><a id="nav_plainstatements" class="navseclink" href="plainstatements.xhtml#plainstatements">Plain Statements</a><a id="nav_plainstatements1" class="navsublink" href="plainstatements.xhtml#plainstatements1">Plain Statement</a><a id="nav_escape" class="navseclink" href="escape.xhtml#escape">SQL Escape Syntax</a><a id="nav_escapesyntax" class="navsublink" href="escape.xhtml#escapesyntax">Escape Syntax</a><a id="nav_dateliterals" class="navsublink" href="escape.xhtml#dateliterals">Date Literals</a><a id="nav_escapefunctions" class="navsublink" href="escape.xhtml#escapefunctions">Functions</a><a id="nav_escapefunctionlist" class="navsublink" href="escape.xhtml#escapefunctionlist">List of Supported Functions</a><a id="nav_storedproceduresescape" class="navsublink" href="escape.xhtml#storedproceduresescape">Stored Procedures</a><a id="nav_likeescape" class="navsublink" href="escape.xhtml#likeescape">LIKE Escape</a><a id="nav_outerjoinsescape" class="navsublink" href="escape.xhtml#outerjoinsescape">Outer Joins</a><span class="navseclink">How to...</span><a id="nav_storedprocedures" class="navsublink" href="storedprocedures.xhtml#storedprocedures">How to Invoke Stored Procedures (CallableStatement)</a><a id="nav_readingnull" class="navsublink" href="readingnull.xhtml#readingnull">How to Find Out Whether a ResultSet Column is NULL</a><a id="nav_cursors" class="navsublink" href="cursors.xhtml#cursors">How to Navigate in the ResultSet (Cursors)</a><a id="nav_holdablers" class="navsublink" href="holdablers.xhtml#holdablers">How to Control ResultSet Holdability</a><a id="nav_arrays" class="navsublink" href="arrays.xhtml#arrays">How to Handle SQL Arrays</a><a id="nav_creatingsql" class="navsublink" href="creatingsql.xhtml#creatingsql">How to Escape Strings in SQL to Prevent SQL Injection Attacks</a><a id="nav_batch" class="navsublink" href="batch.xhtml#batch">How to Do a Batch Updates</a><a id="nav_performance" class="navsublink" href="performance.xhtml#performance">How to Improve Performance</a><a id="nav_dateandtime" class="navsublink" href="dateandtime.xhtml#dateandtime">How to Handle Date and Time</a><a id="nav_fetchsizes" class="navsublink" href="fetchsizes.xhtml#fetchsizes">How to Set the Fetch Size</a><a id="nav_timeout" class="navsublink" href="timeout.xhtml#timeout">How to Set the Query Timeout</a><a id="nav_rowsets" class="navsublink" href="rowsets.xhtml#rowsets">What are RowSets?</a><a id="nav_dbmetadata" class="navsublink" href="dbmetadata.xhtml#dbmetadata">How to Find Out the Database's Capabilities (DatabaseMetaData)</a><a id="nav_resultsetmetadata" class="navsublink" href="resultsetmetadata.xhtml#resultsetmetadata">How to Find Out About the Columns of a ResultSet (ResultSetMetaData)</a><a id="nav_blobs" class="navsublink" href="blobs.xhtml#blobs">How to Use Blobs and Clobs</a><a id="nav_xml" class="navsublink" href="xml.xhtml#xml">How to Access XML</a><a id="nav_arrayparameters" class="navsublink" href="arrayparameters.xhtml#arrayparameters">How to Pass an Array as Parameter for the IN operator</a><a id="nav_transactionisolation" class="navsublink" href="transactionisolation.xhtml#transactionisolation">How to Set the Transaction Isolation Level</a><a id="nav_drivercats" class="navsublink" href="drivercats.xhtml#drivercats">What are JDBC Driver Categories?</a><a id="nav_wheretoputstatements" class="navsublink" href="wheretoputstatements.xhtml#wheretoputstatements">Where to Put SQL Statements</a><a id="nav_dboverview" class="navsublink" href="dboverview.xhtml#dboverview">Which Database is the Right One? (Short Database Overview)</a><a id="nav_concurrency" class="navsublink" href="concurrency.xhtml#concurrency">How to Use JDBC in Multi-Threaded Applications</a><a id="nav_warnings" class="navsublink" href="warnings.xhtml#warnings">How to Read Warnings by the Driver or Database (SQLWarning)</a><a id="nav_types" class="navsublink" href="types.xhtml#types">How to Map Between Java Types and JDBC Types</a><a id="nav_todo" class="navsublink" href="todo.xhtml#todo">TODO</a><a id="nav_appservertransactions" class="navsublink" href="appservertransactions.xhtml#appservertransactions">How to Use Transactions in an Application Server</a><a id="nav_autokeys" class="navsublink" href="autokeys.xhtml#autokeys">How to Retrieve Generated Values (Auto-Generated Keys)</a><a id="nav_userdefinedtypes" class="navsublink" href="userdefinedtypes.xhtml#userdefinedtypes">How to Write a Custom-Mapping for User-Defined Types</a><a id="nav_distinct" class="navsublink" href="distinct.xhtml#distinct">How to Handle Scalar User-Defined Types (Distinct)?</a><a id="nav_structs" class="navsublink" href="structs.xhtml#structs">How to Read Composite Types (Structs)</a><a id="nav_nullparameters" class="navsublink" href="nullparameters.xhtml#nullparameters">How to Set Parameters to NULL</a><a id="nav_wrapper" class="navsublink" href="wrapper.xhtml#wrapper">How to Access Driver Classes When the Application Server Wraps Them</a><a id="nav_andnow" class="navseclink" href="andnow.xhtml#andnow">And now...?</a><a id="nav_nextsteps" class="navsublink" href="andnow.xhtml#nextsteps">Next Steps</a></div></div><div id="popups"><div id="pp-d5630e1959" class="tooltip">To use transactions you need to turn off the <span class="idf">Connection</span>'s auto-commit mode with <span class="idf">setAutoCommit</span>. Then every statement you issue is part of the same transaction, until you call <span class="idf">commit</span> or <span class="idf">rollback</span>, which start a new transaction.<br/> This built-in transaction mechanism can only be used for transactions within the database. Distributed transactions, over several databases, require an external transaction manager.</div><div id="pp-d5630e2168" class="tooltip"> Database resources are expensive and limited. You can improve performance by closing resources manuallly, instead of waiting for the garbage collection.<br/> Closing a resource closes all constituent objects. So if you close a <span class="idf">Statement</span>, its <span class="idf">ResultSet</span>s will be closed automatically. And if you close a <span class="idf">Connection</span>, its <span class="idf">Statement</span>s and <span class="idf">ResultSet</span>s will be closed.</div><div id="pp-d5630e2306" class="tooltip">When you close a statement, its current <span class="idf">ResultSet</span> will be closed as well.</div><div id="pp-d5630e1983" class="tooltip">Auto-commit means that every statement is automatically committed right after executing it. In order to have transactions with JDBC in a stand-alone application, you need to disable the auto-commit mode and then invoke <span class="idf">commit</span> or <span class="idf">rollback</span> expliticly. In an application server, you should let the container manage transactions.</div><div id="pp-d5630e1998" class="tooltip">When you execute a writing statement (such as an <span class="idf">UPDATE</span> or <span class="idf">INSERT</span>) in a transaction, the database will not be permanently modified yet. <em>Only after calling <span class="idf">commit</span></em> the changes will be visible to other transactions. Alternatively you can also call <span class="idf">rollback</span> and all changes will be forgotten.<br/> Transactions are important, for example, when you have a table representing bank accounts, and you transfer money from one account to another. You need to deduct the amount from the first account and add it to the second. This can only be done using two <span class="idf">UPDATE</span> statements. But it must never happen that only the first statement succeeds and then the second fails - otherwise the money would just disappear. So you put it in a transaction, and then it is guaranteed that either both statements are executed, or none at all.</div><div id="ttCloseBar" class="closeBar"><a href="#" onclick="return tlClose();"><img src="../../images/close.png" height="16" width="16" alt="close"/></a></div><div id="topicCloseBar" class="closeBar"><a href="#" onclick="return tpcClose();"><img src="../../images/close.png" height="16" width="16" alt="close"/></a></div></div></body></html>