<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns="http://www.w3.org/1999/xhtml" xmlns:fn="http://www.w3.org/2005/xpath-functions" xmlns:page="http://tjansen.de/refPage" xmlns:i="http://tjansen.de/internal"><head><title>How to Generate Images as Response - Servlet 2.5 Guide</title><meta http-equiv="X-UA-Compatible" content="chrome=1"/><meta http-equiv="content-language" content="en"/><link rel="shortcut icon" href="../../images/favicon.png" type="image/png"/><link rel="stylesheet" type="text/css" href="../../style/style.css"/><script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-6791190-2']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
})();
</script><script type="text/javascript" src="../../js/all.js"/></head><body id="body"><div id="visibleContent"><div id="top"><a href="/"><img src="../../images/titlebar.png" alt="Jarfiller.com"/></a></div><div id="main"><div id="bodycolumn"><div class="yahbar"><div class="yahprev"><a href="sendingxml.xhtml">Prev</a></div><h3 class="yahhere"><a href="#" onclick="return navToggle();">Servlet 2.5 Guide / How to... Requests and Responses</a></h3><div class="yahnext"><a href="jspforward.xhtml">Next</a></div></div><h1 id="sec_howtorequestresponses" class="multipageTitle">How to Generate Images as Response</h1><div class="subSecRow2" id="sec_dynamicimages"><div class="subSecHead" id="sechd_dynamicimages"><a name="dynamicimages">Dynamic Images</a></div><div class="subSecContent" id="seccnt_dynamicimages"><p class="subSecExplanation">You can use the <a href="http://java.sun.com/products/java-media/2D/index.jsp">Java 2D API</a> to create images dynamically, encode them as PNG or JPEG and send them to the client. The following servlet draws a simple clock with the current time and sends it as response:</p><pre class="subSecCode"><code>import <a href="http://java.sun.com/javase/6/docs/api/java/awt/package-summary.html" class="javadoc">java.awt.*</a>;
import <a href="http://java.sun.com/javase/6/docs/api/java/awt/image/package-summary.html" class="javadoc">java.awt.image.*</a>;
import <a href="http://java.sun.com/javase/6/docs/api/javax/imageio/package-summary.html" class="javadoc">javax.imageio.*</a>;
import <a href="http://java.sun.com/javaee/5/docs/api/javax/servlet/http/package-summary.html" class="javadoc">javax.servlet.http.*</a>;
import <a href="http://java.sun.com/javase/6/docs/api/java/io/package-summary.html" class="javadoc">java.io.*</a>;
import <a href="http://java.sun.com/javase/6/docs/api/java/util/package-summary.html" class="javadoc">java.util.*</a>;

<span class="cmt">// Servlet that draws a clock</span>
public class ClockServlet extends <a href="http://java.sun.com/javaee/5/docs/api/javax/servlet/http/HttpServlet.html" class="javadoc">HttpServlet</a> {

    <span class="cmt">// create the image</span>
    private BufferedImage createClockImage() {
        <a href="http://java.sun.com/javase/6/docs/api/java/util/GregorianCalendar.html" class="javadoc">GregorianCalendar</a> cal = new <a href="http://java.sun.com/javase/6/docs/api/java/util/GregorianCalendar.html" class="javadoc">GregorianCalendar</a>();

        <a href="http://java.sun.com/javase/6/docs/api/java/awt/image/BufferedImage.html" class="javadoc">BufferedImage</a> img = <em>new <a href="http://java.sun.com/javase/6/docs/api/java/awt/image/BufferedImage.html" class="javadoc">BufferedImage</a></em>(400, 400, <a href="http://java.sun.com/javase/6/docs/api/java/awt/image/BufferedImage.html#TYPE_3BYTE_BGR" class="javadoc">BufferedImage.TYPE_3BYTE_BGR</a>);
        <a href="http://java.sun.com/javase/6/docs/api/java/awt/Graphics2D.html" class="javadoc">Graphics2D</a> g = img.<a href="http://java.sun.com/javase/6/docs/api/java/awt/image/BufferedImage.html#createGraphics()" class="javadoc">createGraphics</a>();

        <span class="cmt">// white background</span>
        g.<a href="http://java.sun.com/javase/6/docs/api/java/awt/Graphics.html#setColor(java.awt.Color)" class="javadoc">setColor</a>(<a href="http://java.sun.com/javase/6/docs/api/java/awt/Color.html#WHITE" class="javadoc">Color.WHITE</a>);
        g.<a href="http://java.sun.com/javase/6/docs/api/java/awt/Graphics.html#fillRect(int, int, int, int)" class="javadoc">fillRect</a>(0, 0, 400, 400);

        <span class="cmt">// draw black circle around clock</span>
        g.<a href="http://java.sun.com/javase/6/docs/api/java/awt/Graphics.html#setColor(java.awt.Color)" class="javadoc">setColor</a>(<a href="http://java.sun.com/javase/6/docs/api/java/awt/Color.html#BLACK" class="javadoc">Color.BLACK</a>);
        g.<a href="http://java.sun.com/javase/6/docs/api/java/awt/Graphics2D.html#setStroke(java.awt.Stroke)" class="javadoc">setStroke</a>(new <a href="http://java.sun.com/javase/6/docs/api/java/awt/BasicStroke.html" class="javadoc">BasicStroke</a>(5));
        g.<a href="http://java.sun.com/javase/6/docs/api/java/awt/Graphics.html#drawOval(int, int, int, int)" class="javadoc">drawOval</a>(20, 20, 360, 360);

        <span class="cmt">// draw hour hand</span>
        double hourRad = cal.<a href="http://java.sun.com/javase/6/docs/api/java/util/Calendar.html#get(int)" class="javadoc">get</a>(<a href="http://java.sun.com/javase/6/docs/api/java/util/Calendar.html#HOUR" class="javadoc">Calendar.HOUR</a>) * 2 * Math.PI / 12 - 0.5 * Math.PI;
        g.<a href="http://java.sun.com/javase/6/docs/api/java/awt/Graphics.html#drawLine(int, int, int, int)" class="javadoc">drawLine</a>(200, 200, 200 + (int) (100 * Math.cos(hourRad)), 
                   200 + (int) (100 * Math.sin(hourRad)));

        <span class="cmt">// draw minute hand</span>
        double minuteRad = cal.get(<a href="http://java.sun.com/javase/6/docs/api/java/util/Calendar.html#MINUTE" class="javadoc">Calendar.MINUTE</a>) * 2 * Math.PI / 60 - 0.5 * Math.PI;
        g.<a href="http://java.sun.com/javase/6/docs/api/java/awt/Graphics.html#drawLine(int, int, int, int)" class="javadoc">drawLine</a>(200, 200, 200 + (int) (170 * Math.cos(minuteRad)), 
                   200 + (int) (170 * Math.sin(minuteRad)));
        return img;
    }

    protected void <a href="http://java.sun.com/javaee/5/docs/api/javax/servlet/http/HttpServlet.html#doGet(javax.servlet.http.HttpServletRequest, javax.servlet.http.HttpServletResponse)" class="javadoc">doGet</a>(<a href="http://java.sun.com/javaee/5/docs/api/javax/servlet/http/HttpServletRequest.html" class="javadoc">HttpServletRequest</a> request, <a href="http://java.sun.com/javaee/5/docs/api/javax/servlet/http/HttpServletResponse.html" class="javadoc">HttpServletResponse</a> response)
          throws <a href="http://java.sun.com/javase/6/docs/api/java/io/IOException.html" class="javadoc">IOException</a> {

        response.<a href="http://java.sun.com/javaee/5/docs/api/javax/servlet/ServletResponse.html#setContentType(java.lang.String)" class="javadoc">setContentType</a>("image/png");

        OutputStream os = response.<a href="http://java.sun.com/javaee/5/docs/api/javax/servlet/ServletResponse.html#getOutputStream()" class="javadoc">getOutputStream</a>();
        <a href="http://java.sun.com/javase/6/docs/api/javax/imageio/ImageIO.html#write(java.awt.image.RenderedImage, java.lang.String, java.io.OutputStream)" class="javadoc"><em>ImageIO.write</em></a>(createClockImage(), "PNG", os);  <span class="cmt">// write image as PNG (<a href="#" id="tl-d22757e8242" class="dottedTooltip" onclick="return tlClick('tl-d22757e8242','pp-d22757e8242');" onmouseover="return tlOver('tl-d22757e8242','pp-d22757e8242');" onmouseout="return tlOut('tl-d22757e8242','pp-d22757e8242');">more</a>)</span>
    }
}
</code></pre><p class="subSecExplanation"/></div></div><div class="yahbar"><div class="yahprev"><a href="sendingxml.xhtml">Prev<br/><span>How to Send XML as Response</span></a></div><div class="yahhere"><a href="#" onclick="return navToggle();">Servlet 2.5 Guide / How to... Requests and Responses</a><br/><a href="/guide/servlet25/"><span>Single Page Mode</span></a>, <a href="#" onclick="return navToggle();"><span>Show Table of Content</span></a></div><div class="yahnext"><a href="jspforward.xhtml">Next<br/><span>How to Use a JSP as Template</span></a></div></div></div><div id="sidecolumn">
    	<div><h3>Useful Links</h3><div class="sidecolumnSubTitleLine"/>
	  			<a href="http://java.sun.com/products/servlet/">Servlet Homepage</a><br/>
	  			<a href="http://en.wikipedia.org/wiki/Java_Servlet">Servlet on Wikipedia</a><br/>
	  			<a href="http://java.sun.com/javaee/5/docs/api/javax/servlet/package-summary.html">javax.servlet API Docs</a><br/>
	  			<a href="http://java.sun.com/javaee/5/docs/api/javax/servlet/package-summary.html">javax.servlet.http API Docs</a><br/>
	  			<a href="http://jcp.org/aboutJava/communityprocess/mrel/jsr154/index2.html">Servlet 2.5 Specification</a><br/>
	  		</div>
  		
  		<div><h3>Related Documents</h3><div class="sidecolumnSubTitleLine">(on Jarfiller.com)</div>
	  			<a href="/reference/webxml2x/">Web.xml Reference</a><br/>
	  		</div>
  	
  </div></div></div><div id="footer"><div id="footer-content"><div id="footer-left"><div class="footerLine"><a href="/">Home</a> - <a href="/about">About Jarfiller</a> - <a href="/imprint.xhtml">Imprint</a></div><div class="footerLine">Please send feedback and corrections to <a href="mailto:tim@tjansen.de">tim@<span style="display: none">got you</span>tjansen.de</a>.</div><div class="footerLine"><a href="http://www.twitter.com/timjansen">Follow</a> me on Twitter.</div><div class="copyrightLine">Â© 2010 Tim Jansen; content licensed under <a href="http://creativecommons.org/licenses/by/3.0/us/">cc-by</a>; example source code is public domain
				</div></div><div id="footer-right"><a rel="license" href="http://creativecommons.org/licenses/by/3.0/us/"><img alt="Creative Commons License" style="border-width:0" src="../../images/ext/cc-by-88x31.png"/></a></div></div></div><div id="navbar" onclick="return navToggle();" onmouseover="document.getElementById('navbar').className='mouseover';" onmouseout="document.getElementById('navbar').className='';"/><div id="navcontainer"><div id="navlinks"><div id="navclosebar"><a href="#" onclick="return navClose();"><img src="../../images/close.png" height="16" width="16" alt="close"/></a></div><div id="navpositionbar" class="navpositionbar"/><h2 id="navtitle">Servlet 2.5 Guide</h2><a id="nav_overview" class="navseclink" href="overview.xhtml#overview">Overview</a><a id="nav_intro" class="navsublink" href="overview.xhtml#intro">Intro</a><a id="nav_usecases" class="navsublink" href="overview.xhtml#usecases">When should you write a Servlet?</a><a id="nav_requirements" class="navsublink" href="overview.xhtml#requirements">What do you need for Servlets?</a><a id="nav_containers" class="navsublink" href="overview.xhtml#containers">Which container supports which Servlet / JEE version?</a><a id="nav_httpintro" class="navsublink" href="overview.xhtml#httpintro">Short HTTP Introduction</a><a id="nav_servlets" class="navseclink" href="servlets.xhtml#servlets">Servlets</a><a id="nav_servletintro" class="navsublink" href="servlets.xhtml#servletintro">Servlet Intro</a><a id="nav_classoverview" class="navsublink" href="servlets.xhtml#classoverview">Class Overview</a><a id="nav_servletclass" class="navsublink" href="servlets.xhtml#servletclass">Servlet Class</a><a id="nav_servicemethods" class="navsublink" href="servlets.xhtml#servicemethods">Service Dispatching in the HttpServlet</a><a id="nav_lifecycle" class="navsublink" href="servlets.xhtml#lifecycle">The Servlet Lifecycle</a><a id="nav_multithreading" class="navsublink" href="servlets.xhtml#multithreading">Multithreading</a><a id="nav_twothreadsafeways" class="navsublink" href="servlets.xhtml#twothreadsafeways">Two Simple Ways to Write Thread-Safe Servlets</a><a id="nav_webapplications" class="navsublink" href="servlets.xhtml#webapplications">Web Applications</a><a id="nav_webxml" class="navsublink" href="servlets.xhtml#webxml">web.xml</a><a id="nav_applayout" class="navsublink" href="servlets.xhtml#applayout">Example Application Layout</a><a id="nav_contextroot" class="navsublink" href="servlets.xhtml#contextroot">Context Root</a><a id="nav_staticcontent" class="navsublink" href="servlets.xhtml#staticcontent">Static Content</a><a id="nav_eclipse" class="navsublink" href="servlets.xhtml#eclipse">How to Create a Web Application with Eclipse</a><a id="nav_ant" class="navsublink" href="servlets.xhtml#ant">How to Create a Web Application (WAR) with Ant</a><a id="nav_tomcat" class="navsublink" href="servlets.xhtml#tomcat">How to Deploy a Web Application on Tomcat</a><a id="nav_responses" class="navseclink" href="responses.xhtml#responses">Responses</a><a id="nav_textoutput" class="navsublink" href="responses.xhtml#textoutput">Text Output</a><a id="nav_responsebinary" class="navsublink" href="responses.xhtml#responsebinary">Binary Output</a><a id="nav_buffering" class="navsublink" href="responses.xhtml#buffering">Buffering and Committing</a><a id="nav_errors" class="navsublink" href="responses.xhtml#errors">Error Code</a><a id="nav_redirection" class="navsublink" href="responses.xhtml#redirection">Redirection</a><a id="nav_requests" class="navseclink" href="requests.xhtml#requests">Requests</a><a id="nav_reqparameters" class="navsublink" href="requests.xhtml#reqparameters">Request Parameters</a><a id="nav_parameternames" class="navsublink" href="requests.xhtml#parameternames">How to find out which parameters have been sent</a><a id="nav_headers" class="navsublink" href="requests.xhtml#headers">How to read header values</a><a id="nav_paths" class="navsublink" href="requests.xhtml#paths">Paths</a><a id="nav_sessionsandcookies" class="navseclink" href="sessionsandcookies.xhtml#sessionsandcookies">Sessions and Cookies</a><a id="nav_cookies" class="navsublink" href="sessionsandcookies.xhtml#cookies">Cookies</a><a id="nav_sessions" class="navsublink" href="sessionsandcookies.xhtml#sessions">Sessions</a><a id="nav_distributablesessions" class="navsublink" href="sessionsandcookies.xhtml#distributablesessions">Sessions in Distributed Servers (Clusters)</a><a id="nav_sessioncaveat" class="navsublink" href="sessionsandcookies.xhtml#sessioncaveat">Be Careful When Using HttpSession</a><a id="nav_resources" class="navseclink" href="resources.xhtml#resources">Resources</a><a id="nav_resourceannotations" class="navsublink" href="resources.xhtml#resourceannotations">Resource Annotations</a><a id="nav_jndilookup" class="navsublink" href="resources.xhtml#jndilookup">How to get resources with JNDI</a><a id="nav_tomcatresources" class="navsublink" href="resources.xhtml#tomcatresources">How to Provide Resources in Tomcat</a><span class="navseclink">How to... Requests and Responses</span><a id="nav_customheaders" class="navsublink" href="customheaders.xhtml#customheaders">How to Read and Write Additional Headers</a><a id="nav_attributes" class="navsublink" href="attributes.xhtml#attributes">How to Use Attributes in Request and Context</a><a id="nav_getlastmodified" class="navsublink" href="getlastmodified.xhtml#getlastmodified">How to Use HttpServlet.getLastModified to Improve Client-Side Caching</a><a id="nav_contentlength" class="navsublink" href="contentlength.xhtml#contentlength">How to Set the Content Length</a><a id="nav_fileupload" class="navsublink" href="fileupload.xhtml#fileupload">How to Receive File Uploads (Multi-Part File Upload)</a><a id="nav_browserdetection" class="navsublink" href="browserdetection.xhtml#browserdetection">How to Detect the User's Web Browser</a><a id="nav_contentlanguage" class="navsublink" href="contentlanguage.xhtml#contentlanguage">How to Declare the Content Language</a><a id="nav_acceptedlanguages" class="navsublink" href="acceptedlanguages.xhtml#acceptedlanguages">How to Detect the Client's Preferred Languages</a><a id="nav_sendingxml" class="navsublink" href="sendingxml.xhtml#sendingxml">How to Send XML as Response</a><a id="nav_dynamicimages" class="navsublink" href="dynamicimages.xhtml#dynamicimages">How to Generate Images as Response</a><a id="nav_jspforward" class="navsublink" href="jspforward.xhtml#jspforward">How to Use a JSP as Template</a><a id="nav_requestdispatcher" class="navsublink" href="requestdispatcher.xhtml#requestdispatcher">How to Invoke Servlets and JSPs with the RequestDispatcher</a><a id="nav_virtualhosts" class="navsublink" href="virtualhosts.xhtml#virtualhosts">How to Handle Virtual Hosts and Multiple IP Addresses?</a><a id="nav_filters" class="navsublink" href="filters.xhtml#filters">How to Write Filters</a><span class="navseclink">How to... Sessions and Security</span><a id="nav_usermanagement" class="navsublink" href="usermanagement.xhtml#usermanagement">How to Authenticate and Manage Users</a><a id="nav_declarativesecurity" class="navsublink" href="declarativesecurity.xhtml#declarativesecurity">How to Restrict Access to a Web Application (Declarative Security)</a><a id="nav_requiringssl" class="navsublink" href="requiringssl.xhtml#requiringssl">How to Require HTTPS / SSL</a><a id="nav_programmaticsecurity" class="navsublink" href="programmaticsecurity.xhtml#programmaticsecurity">How to Use Authentication Data in Servlets</a><a id="nav_cookielessessions" class="navsublink" href="cookielessessions.xhtml#cookielessessions">How to Use HttpSessions and Authentication without Cookies?</a><span class="navseclink">How to... General</span><a id="nav_addinglibraries" class="navsublink" href="addinglibraries.xhtml#addinglibraries">How to Add Libraries to a Web Application / WAR</a><a id="nav_addingresourcefiles" class="navsublink" href="addingresourcefiles.xhtml#addingresourcefiles">How to Read Files Contained in a Web Application / WAR</a><a id="nav_throwingexceptions" class="navsublink" href="throwingexceptions.xhtml#throwingexceptions">How to Throw Exceptions in Servlets</a><a id="nav_initparameters" class="navsublink" href="initparameters.xhtml#initparameters">Configure your Servlet with Initialization Parameters</a><a id="nav_logging" class="navsublink" href="logging.xhtml#logging">How to Log</a><a id="nav_errorpages" class="navsublink" href="errorpages.xhtml#errorpages">How to Replace the Default Error Page</a><a id="nav_temporarydirectory" class="navsublink" href="temporarydirectory.xhtml#temporarydirectory">How to Get a Temporary Directory</a><a id="nav_ejbinvocation" class="navsublink" href="ejbinvocation.xhtml#ejbinvocation">How to Access an EJB</a><a id="nav_distributedapps" class="navsublink" href="distributedapps.xhtml#distributedapps">How to Create a Distributed Application</a><a id="nav_listeners" class="navsublink" href="listeners.xhtml#listeners">How to Be Notified about Events (Listeners)</a><a id="nav_servlet24" class="navsublink" href="servlet24.xhtml#servlet24">New Features Since Servlet API 2.4</a><a id="nav_andnow" class="navseclink" href="andnow.xhtml#andnow">And now...?</a><a id="nav_nextsteps" class="navsublink" href="andnow.xhtml#nextsteps">Next Steps</a></div></div><div id="popups"><div id="pp-d22757e8242" class="tooltip">All the 'magic' is done here: <span class="idf">ImageIO.write</span> takes the <span class="idf">BufferedImage</span> and writes it as PNG into the <span class="idf">OutputStream</span>.</div><div id="ttCloseBar" class="closeBar"><a href="#" onclick="return tlClose();"><img src="../../images/close.png" height="16" width="16" alt="close"/></a></div><div id="topicCloseBar" class="closeBar"><a href="#" onclick="return tpcClose();"><img src="../../images/close.png" height="16" width="16" alt="close"/></a></div></div></body></html>